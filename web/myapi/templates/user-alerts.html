<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Consultar Alertas</title>
</head>
<body>
    <h1>Consultar Alertas del Usuario</h1>

    <input type="text" id="userEmail" placeholder="Ingrese email del usuario">
    <button id="btnConsultar">Consultar</button>

    <div id="result"></div>

    <script>
        document.getElementById("btnConsultar").onclick = async function() {
            const email = document.getElementById("userEmail").value.trim();
            if (!email) {
                document.getElementById("result").innerText = "Por favor ingrese un email.";
                return;
            }

            try {
                const res = await fetch("/api/alerts", {
                    method: "POST",
                    headers: { "Content-Type": "application/json; charset=utf-8" },
                    body: JSON.stringify({ email: email })
                });

                const contentType = res.headers.get("content-type");
                if (!contentType || !contentType.includes("application/json")) {
                    const text = await res.text();
                    throw new Error("Respuesta no es JSON: " + text);
                }

                const data = await res.json();

                const resultDiv = document.getElementById("result");
                resultDiv.innerHTML = ""; // Limpia resultados previos

                if (Array.isArray(data) && data.length > 0) {
                    const ul = document.createElement("ul");
                    data.forEach(alert => {
                        const li = document.createElement("li");
                        li.textContent = `Id: ${alert.id} -Source: ${alert.source} -Severity: ${alert.severity}`;
                        ul.appendChild(li);
                    });
                    resultDiv.appendChild(ul);
                } else if (data.error) {
                    resultDiv.innerText = "Error: " + data.error;
                } else {
                    resultDiv.innerText = "No se encontraron alertas.";
                }

            } catch (err) {
                document.getElementById("result").innerText = "Error: " + err.message;
            }
        };
    </script>
</body>
</html>
